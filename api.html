
<!DOCTYPE html>


<html lang="en" data-content_root="./" data-theme="dark">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Auto-generated API reference from docstrings. Complete documentation for standardized_transformer, interventions, prompt_utils, display, nnsight_utils, and internal modules." name="llm-description" />

    <title>Documentation &#8212; nnterp</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "dark";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "dark";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=519ae551" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api';</script>
    <script src="_static/source-link-navbar.js?v=9c7d967d"></script>
    <link rel="canonical" href="https://butanium.github.io/nnterp/api.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="NNsight Utils" href="nnsight-utils.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="dark">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">nnterp</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="getting-started/quickstart.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="basic-usage.html">
    Basic Usage
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="interventions.html">
    Interventions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="model-validation.html">
    Model Validation & Testing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="adding-model-support.html">
    Adding Support for Your Model
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="advanced-features.html">
    Advanced Features
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="nnsight-best-practices.html">
    NNsight Best Practices
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="nnsight-utils.html">
    NNsight Utils
  </a>
</li>


<li class=" current active">
  <a class="nav-link dropdown-item nav-internal" href="#">
    Documentation
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/butanium/nnterp" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="getting-started/quickstart.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="basic-usage.html">
    Basic Usage
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="interventions.html">
    Interventions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="model-validation.html">
    Model Validation & Testing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="adding-model-support.html">
    Adding Support for Your Model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="advanced-features.html">
    Advanced Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="nnsight-best-practices.html">
    NNsight Best Practices
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="nnsight-utils.html">
    NNsight Utils
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Documentation
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/butanium/nnterp" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Documentation</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="documentation">
<h1>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">#</a></h1>
<section id="module-nnterp.standardized_transformer">
<span id="nnterp-standardized-transformer-module"></span><h2>nnterp.standardized_transformer module<a class="headerlink" href="#module-nnterp.standardized_transformer" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">StandardizedTransformer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trust_remote_code</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_renaming</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_dispatch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_attention_probs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_attn_probs_with_trace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">LanguageModel</span></code></p>
<p>Renames the LanguageModel modules to match a standardized architecture.</p>
<p>The model structure is organized as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>StandardizedTransformer
├── embed_tokens
├── layers
│   ├── self_attn
│   └── mlp
├── ln_final
└── lm_head
</pre></div>
</div>
<p>In addition to renaming modules, this class provides built-in accessors to extract and set intermediate activations:</p>
<ul class="simple">
<li><p>embed_tokens: Get embedding module</p></li>
<li><p>token_embeddings: Get/set token embeddings (equivalent to embed_tokens.output)</p></li>
<li><p>layers[i]: Get layer module at layer i</p></li>
<li><p>layers_input[i]: Get/set layer input at layer i</p></li>
<li><p>layers_output[i]: Get/set layer output at layer i</p></li>
<li><p>attentions[i]: Get attention module at layer i</p></li>
<li><p>attentions_input[i] / attentions_output[i]: Get/set attention input/output at layer i</p></li>
<li><p>mlps[i]: Get MLP module at layer i</p></li>
<li><p>mlps_input[i] / mlps_output[i]: Get/set MLP input/output at layer i</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>repo_id</strong> (<em>str</em>) – Hugging Face repository ID or path of the model to load.</p></li>
<li><p><strong>trust_remote_code</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, remote code will be trusted when
loading the model. Defaults to False.</p></li>
<li><p><strong>check_renaming</strong> (<em>bool</em><em>, </em><em>default True</em>) – If True, the renaming of modules is validated.
Defaults to True.</p></li>
<li><p><strong>allow_dispatch</strong> (<em>bool</em><em>, </em><em>default True</em>) – If True, allows using trace() to dispatch the model
when scan() fails during renaming checks. Defaults to True. You should set this to false
if you plan to use the model remotely.</p></li>
<li><p><strong>enable_attention_probs</strong> (<em>bool</em><em>, </em><em>default False</em>) – If True, enables attention probabilities
tracing by setting attn_implementation=”eager”. Defaults to False.</p></li>
<li><p><strong>check_attn_probs_with_trace</strong> (<em>bool</em><em>, </em><em>default True</em>) – If True, the model will be dispatched and a test will ensure that the attention probabilities returned sum to 1.</p></li>
<li><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em>, </em><em>default None</em>) – A RenameConfig object to use for renaming the model. If None, a default RenameConfig will be used.</p></li>
<li><p><strong>model</strong> (<em>str</em><em> | </em><em>Module</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.num_layers">
<span class="sig-name descname"><span class="pre">num_layers</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.num_layers" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.num_heads">
<span class="sig-name descname"><span class="pre">num_heads</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.num_heads" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.hidden_size">
<span class="sig-name descname"><span class="pre">hidden_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.hidden_size" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.vocab_size">
<span class="sig-name descname"><span class="pre">vocab_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.vocab_size" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.detect_layer_output_type">
<span class="sig-name descname"><span class="pre">detect_layer_output_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer.detect_layer_output_type"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.detect_layer_output_type" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.add_prefix_false_tokenizer">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">add_prefix_false_tokenizer</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">PreTrainedTokenizerBase</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.add_prefix_false_tokenizer" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.attn_probs_available">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">attn_probs_available</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.attn_probs_available" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.input_ids">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input_ids</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Object</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.input_ids" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.input_size">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Size</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.input_size" title="Link to this definition">#</a></dt>
<dd><p>Returns the shape of the input tensor (batch_size, sequence_length)</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.attention_mask">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">attention_mask</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Object</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.attention_mask" title="Link to this definition">#</a></dt>
<dd><p>Returns the attention mask tensor.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.token_embeddings">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">token_embeddings</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Object</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.token_embeddings" title="Link to this definition">#</a></dt>
<dd><p>Returns the token embeddings. Equivalent to self.embed_tokens.output</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.logits">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">logits</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Object</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.logits" title="Link to this definition">#</a></dt>
<dd><p>Returns the predicted logits.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.next_token_probs">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">next_token_probs</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Object</span></em><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.next_token_probs" title="Link to this definition">#</a></dt>
<dd><p>Returns the predicted probabilities for the next token.
Assumes padding_side is “left”.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.skip_layer">
<span class="sig-name descname"><span class="pre">skip_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_with</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer.skip_layer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.skip_layer" title="Link to this definition">#</a></dt>
<dd><p>Skip the computation of a layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>int</em>) – The layer to skip</p></li>
<li><p><strong>skip_with</strong> (<em>Tensor</em><em> | </em><em>Object</em><em> | </em><em>None</em>) – The input to skip the layer with. If None, the input of the layer is used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.skip_layers">
<span class="sig-name descname"><span class="pre">skip_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_with</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_returns_tuple</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer.skip_layers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.skip_layers" title="Link to this definition">#</a></dt>
<dd><p>Skip all layers between start_layer and end_layer (inclusive).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_layer</strong> (<em>int</em>) – The layer to start skipping from</p></li>
<li><p><strong>end_layer</strong> (<em>int</em>) – The layer to stop skipping at (inclusive)</p></li>
<li><p><strong>skip_with</strong> (<em>Tensor</em><em> | </em><em>Object</em><em> | </em><em>None</em>) – The tensor to skip the layers with, will be passed as the output of the layers. If None, the input of start_layer is used.</p></li>
<li><p><strong>layer_returns_tuple</strong> (<em>bool</em><em> | </em><em>None</em>) – Whether the layer output is a tuple. Doesn’t need to be provided if the model’s renaming has been validated or if you ran model.detect_layer_output_type() already.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.steer">
<span class="sig-name descname"><span class="pre">steer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steering_vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_layer_object_to_steer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer.steer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.steer" title="Link to this definition">#</a></dt>
<dd><p>Steer the hidden states of a layer using a steering vector.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layers</strong> (<em>int</em><em> | </em><em>list</em><em>[</em><em>int</em><em>]</em>) – The layer(s) to steer</p></li>
<li><p><strong>steering_vector</strong> (<em>Tensor</em>) – The steering vector to apply</p></li>
<li><p><strong>factor</strong> (<em>float</em>) – The factor to multiply the steering vector by</p></li>
<li><p><strong>positions</strong> (<em>int</em><em> | </em><em>list</em><em>[</em><em>int</em><em>] </em><em>| </em><em>Tensor</em><em> | </em><em>None</em>) – The position to steer. If None, all positions are steered.</p></li>
<li><p><strong>get_layer_object_to_steer</strong> (<em>Callable</em><em>[</em><em>[</em><em>int</em><em>]</em><em>, </em><em>Tensor</em><em> | </em><em>Object</em><em>] </em><em>| </em><em>None</em>) – Function that given a layer index, returns the object to steer in the model’s. Default to model.layers_output[layer]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.project_on_vocab">
<span class="sig-name descname"><span class="pre">project_on_vocab</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hidden_state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer.project_on_vocab"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.project_on_vocab" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>hidden_state</strong> (<em>Tensor</em><em> | </em><em>Object</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.probs_to_dict">
<span class="sig-name descname"><span class="pre">probs_to_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tokens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">probs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer.probs_to_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.probs_to_dict" title="Link to this definition">#</a></dt>
<dd><p>Convert a tensor of probabilities to a dictionary mapping tokens to their probabilities</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tokens</strong> (<em>Tensor</em>)</p></li>
<li><p><strong>probs</strong> (<em>Tensor</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict[str, float]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.standardized_transformer.StandardizedTransformer.get_topk_closest_tokens">
<span class="sig-name descname"><span class="pre">get_topk_closest_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hidden_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/standardized_transformer.html#StandardizedTransformer.get_topk_closest_tokens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.standardized_transformer.StandardizedTransformer.get_topk_closest_tokens" title="Link to this definition">#</a></dt>
<dd><p>Get the top-k closest tokens to the hidden state h.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>h</strong> – The hidden state to project on the vocabulary. Shape (batch_size, hidden_size) or (hidden_size,).</p></li>
<li><p><strong>k</strong> – The number of top tokens to return.</p></li>
<li><p><strong>returns_df</strong> – If True, returns a DataFrame instead of a dictionary. Note that you need to have pandas installed for this to work.
Pandas is included in <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">nnterp[display]</span></code>.</p></li>
<li><p><strong>hidden_state</strong> (<em>Tensor</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary mapping tokens to their probabilities if h is 1D, or a list of dictionaries if h is 2D.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, float] | list[dict[str, float]]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-nnterp.interventions">
<span id="nnterp-interventions-module"></span><h2>nnterp.interventions module<a class="headerlink" href="#module-nnterp.interventions" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="nnterp.interventions.logit_lens">
<span class="sig-name descname"><span class="pre">logit_lens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_inv_logits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#logit_lens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.logit_lens" title="Link to this definition">#</a></dt>
<dd><p>Same as logit_lens but for Llama models directly instead of Transformer_lens models.
Get the probabilities of the next token for the last token of each prompt at each layer using the logit lens.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>) – NNSight Language Model</p></li>
<li><p><strong>prompts</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>str</em>) – List of prompts or a single prompt</p></li>
<li><p><strong>remote</strong> – If True, the function will run on the nndif server. See <cite>nnsight.net/status</cite> to check which models are available.</p></li>
<li><p><strong>return_inv_logits</strong> – If True, the function will return the logits applied to the negative of the hidden states.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tensor of shape (num_prompts, num_layers, vocab_size) containing the probabilities
of the next token for each prompt at each layer. Tensor is on the CPU.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tensor</em> | tuple[<em>Tensor</em>, <em>Tensor</em>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPrompt">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">TargetPrompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'str'</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_to_patch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'int'</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#TargetPrompt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.TargetPrompt" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>)</p></li>
<li><p><strong>index_to_patch</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPrompt.prompt">
<span class="sig-name descname"><span class="pre">prompt</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#nnterp.interventions.TargetPrompt.prompt" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPrompt.index_to_patch">
<span class="sig-name descname"><span class="pre">index_to_patch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#nnterp.interventions.TargetPrompt.index_to_patch" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.interventions.repeat_prompt">
<span class="sig-name descname"><span class="pre">repeat_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">words</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'</span> <span class="pre">'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'\n'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">placeholder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'?'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_to_patch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#repeat_prompt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.repeat_prompt" title="Link to this definition">#</a></dt>
<dd><p>Prompt used in the patchscopes paper to predict the next token.
<a class="github reference external" href="https://github.com/PAIR-code/interpretability/blob/master/patchscopes/code/next_token_prediction.ipynb">PAIR-code/interpretability</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>words</strong> – The words to repeat. If None, the words will be “king”, “1135”, “hello”.</p></li>
<li><p><strong>rel</strong> – The string between the repeated words</p></li>
<li><p><strong>sep</strong> – The separator between the words</p></li>
<li><p><strong>placeholder</strong> – The placeholder to use for the last word</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A TargetPrompt object containing the prompt to patch and the index of the token to patch.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPromptBatch">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">TargetPromptBatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_to_patch</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#TargetPromptBatch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.TargetPromptBatch" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to handle multiple target prompts with potentially different indices to patch</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompts</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>)</p></li>
<li><p><strong>index_to_patch</strong> (<em>Tensor</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPromptBatch.prompts">
<span class="sig-name descname"><span class="pre">prompts</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#nnterp.interventions.TargetPromptBatch.prompts" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPromptBatch.index_to_patch">
<span class="sig-name descname"><span class="pre">index_to_patch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tensor</span></em><a class="headerlink" href="#nnterp.interventions.TargetPromptBatch.index_to_patch" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPromptBatch.from_target_prompts">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_target_prompts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompts_</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#TargetPromptBatch.from_target_prompts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.TargetPromptBatch.from_target_prompts" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>prompts_</strong> (<em>list</em><em>[</em><a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a><em>]</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPromptBatch.from_target_prompt">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_target_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#TargetPromptBatch.from_target_prompt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.TargetPromptBatch.from_target_prompt" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a>)</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPromptBatch.from_prompts">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_prompts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_to_patch</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#TargetPromptBatch.from_prompts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.TargetPromptBatch.from_prompts" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompts</strong> (<em>str</em><em> | </em><em>list</em><em>[</em><em>str</em><em>]</em>)</p></li>
<li><p><strong>index_to_patch</strong> (<em>int</em><em> | </em><em>list</em><em>[</em><em>int</em><em>] </em><em>| </em><em>Tensor</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.interventions.TargetPromptBatch.auto">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">auto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#TargetPromptBatch.auto"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.TargetPromptBatch.auto" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_prompt</strong> (<em>str</em><em> | </em><a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a><em> | </em><em>list</em><em>[</em><a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a><em>] </em><em>| </em><a class="reference internal" href="#nnterp.interventions.TargetPromptBatch" title="nnterp.interventions.TargetPromptBatch"><em>TargetPromptBatch</em></a>)</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.interventions.patchscope_lens">
<span class="sig-name descname"><span class="pre">patchscope_lens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_prompts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_patch_prompts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#patchscope_lens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.patchscope_lens" title="Link to this definition">#</a></dt>
<dd><p>Replace the hidden state of the patch_prompt.index_to_patch token in the patch_prompt.prompt with the hidden state of the last token of each prompt at each layer.
Returns the probabilities of the next token in patch_prompt for each prompt for each layer intervention.
:param nn_model: The NNSight TL model
:param source_prompts: List of prompts or a single prompt to get the hidden states of the last token
:param target_patch_prompts: TargetPrompt(s) / TargetPromptBatch containing the prompt to patch and the index of the token to patch
:param layers: Layer / list of layers to intervene on. If None, all layers are intervened on.
:param latents: Tensor of shape (num_layers, num_sources, hidden_size) If None, the hidden states of the last token of each source prompt at each layer are collected. You cannot provide both source_prompts and latents.
:param remote: If True, the function will run on the nndif server. See <cite>nnsight.net/status</cite> to check which models are available.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tensor of shape (num_prompts, num_layers, vocab_size) containing the probabilities
of the next token for each prompt at each layer. Tensor is on the CPU.</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>source_prompts</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>str</em><em> | </em><em>None</em>)</p></li>
<li><p><strong>target_patch_prompts</strong> (<a class="reference internal" href="#nnterp.interventions.TargetPromptBatch" title="nnterp.interventions.TargetPromptBatch"><em>TargetPromptBatch</em></a><em> | </em><em>list</em><em>[</em><a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a><em>] </em><em>| </em><a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a><em> | </em><em>None</em>)</p></li>
<li><p><strong>layers</strong> (<em>int</em><em> | </em><em>list</em><em>[</em><em>int</em><em>] </em><em>| </em><em>None</em>)</p></li>
<li><p><strong>latents</strong> (<em>Tensor</em><em> | </em><em>None</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.interventions.patchscope_generate">
<span class="sig-name descname"><span class="pre">patchscope_generate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_patch_prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#patchscope_generate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.patchscope_generate" title="Link to this definition">#</a></dt>
<dd><p>Replace the hidden state of the patch_prompt.index_to_patch token in the patch_prompt.prompt with the hidden state of the last token of each prompt at each layer.
Returns the probabilities of the next token in patch_prompt for each prompt for each layer intervention.
:param nn_model: The NNSight LanguageModel with llama architecture
:param prompts: List of prompts or a single prompt to get the hidden states of the last token
:param target_patch_prompt: A TargetPrompt object containing the prompt to patch and the index of the token to patch
:param layers: List of layers to intervene on. If None, all layers are intervened on.
:param max_length: The maximum length of the generated sequence
:param remote: If True, the function will run on the nndif server. See <cite>nnsight.net/status</cite> to check which models are available.
:param max_batch_size: The maximum number of prompts to intervene on at once.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tensor of shape (num_prompts, num_layers, vocab_size) containing the probabilities
of the next token for each prompt at each layer. Tensor is on the CPU.</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>prompts</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>str</em>)</p></li>
<li><p><strong>target_patch_prompt</strong> (<a class="reference internal" href="#nnterp.interventions.TargetPrompt" title="nnterp.interventions.TargetPrompt"><em>TargetPrompt</em></a>)</p></li>
<li><p><strong>max_length</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.interventions.steer">
<span class="sig-name descname"><span class="pre">steer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steering_vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position=-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_module=&lt;function</span> <span class="pre">get_layer_output&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#steer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.steer" title="Link to this definition">#</a></dt>
<dd><p>Steer the hidden states of a layer using a steering vector
:param nn_model: The NNSight model
:param layers: The layer(s) to steer
:param steering_vector: The steering vector to apply
:param factor: The factor to multiply the steering vector by</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layers</strong> (<em>int</em><em> | </em><em>list</em><em>[</em><em>int</em><em>]</em>)</p></li>
<li><p><strong>steering_vector</strong> (<em>Tensor</em>)</p></li>
<li><p><strong>factor</strong> (<em>float</em>)</p></li>
<li><p><strong>position</strong> (<em>int</em>)</p></li>
<li><p><strong>get_module</strong> (<em>Callable</em><em>[</em><em>[</em><em>LanguageModel</em><em>, </em><em>int</em><em>]</em><em>, </em><em>Tensor</em><em> | </em><em>Object</em><em>]</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.interventions.patch_object_attn_lens">
<span class="sig-name descname"><span class="pre">patch_object_attn_lens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attn_idx_patch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_patches</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/interventions.html#patch_object_attn_lens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.interventions.patch_object_attn_lens" title="Link to this definition">#</a></dt>
<dd><p>A complex lens that makes the model attend to the hidden states of the last token of the source prompts instead of the attn_idx_patch token of the target prompts at last token prediction. For each layer, this intervention is performed for num_patches layers.
:param nn_model: The NNSight model
:param source_prompts: The prompts to get the hidden states of the last token from
:param target_prompts: The prompts to predict the next token for
:param attn_idx_patch: The index of the token to patch in the target prompts
:param num_patches: The number of layers to patch for each layer</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tensor of shape (num_target_prompts, num_layers, vocab_size) containing the probabilities
of the next token for each target prompt at each layer. Tensor is on the CPU.</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>source_prompts</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>str</em>)</p></li>
<li><p><strong>target_prompts</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>str</em>)</p></li>
<li><p><strong>attn_idx_patch</strong> (<em>int</em>)</p></li>
<li><p><strong>num_patches</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-nnterp.prompt_utils">
<span id="nnterp-prompt-utils-module"></span><h2>nnterp.prompt_utils module<a class="headerlink" href="#module-nnterp.prompt_utils" title="Link to this heading">#</a></h2>
<dl class="py exception">
<dt class="sig sig-object py" id="nnterp.prompt_utils.TokenizationError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">TokenizationError</span></span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#TokenizationError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.TokenizationError" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.prompt_utils.get_first_tokens">
<span class="sig-name descname"><span class="pre">get_first_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">words</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">llm_or_tokenizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_hacky_implementation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#get_first_tokens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.get_first_tokens" title="Link to this definition">#</a></dt>
<dd><p>Get the all the first tokens of a “word” and “ word” for all words.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>words</strong> (<em>str</em><em> | </em><em>list</em><em>[</em><em>str</em><em>]</em>) – A string or a list of strings to get the first token of.</p></li>
<li><p><strong>llm_or_tokenizer</strong> (<em>LanguageModel</em><em> | </em><a class="reference internal" href="#nnterp.standardized_transformer.StandardizedTransformer" title="nnterp.standardized_transformer.StandardizedTransformer"><em>StandardizedTransformer</em></a><em> | </em><em>PreTrainedTokenizerBase</em>) – The tokenizer to use. If a LanguageModel or StandardizedTransformer is provided,
the tokenizer will be extracted from it. It is recommended to use StandardizedTransformer. If you want to use your own tokenizer,
it’s recommended to initialize it with add_prefix_space=False or to use the hacky implementation.</p></li>
<li><p><strong>use_hacky_implementation</strong> – If True, use a hacky implementation to get the first token of a word by tokenizing “🍐word” and extracting the first token of word.
While hacky, it is still guaranteed to work correctly or raise an error.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of tokens.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_tokens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_strings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#Prompt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.Prompt" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Generic class to represent a prompt with target tokens to track during next token prediction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The prompt to use</p></li>
<li><p><strong>target_tokens</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>int</em><em>]</em><em>]</em>) – A dictionary of target tokens for each target</p></li>
<li><p><strong>target_strings</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em> | </em><em>list</em><em>[</em><em>str</em><em>]</em><em>] </em><em>| </em><em>None</em>) – A dictionary of target strings for each target</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt.prompt">
<span class="sig-name descname"><span class="pre">prompt</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#nnterp.prompt_utils.Prompt.prompt" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt.target_tokens">
<span class="sig-name descname"><span class="pre">target_tokens</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#nnterp.prompt_utils.Prompt.target_tokens" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt.target_strings">
<span class="sig-name descname"><span class="pre">target_strings</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.prompt_utils.Prompt.target_strings" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt.from_strings">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_strings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_strings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#Prompt.from_strings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.Prompt.from_strings" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>)</p></li>
<li><p><strong>target_strings</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em> | </em><em>list</em><em>[</em><em>str</em><em>]</em><em>] </em><em>| </em><em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>str</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt.has_no_collisions">
<span class="sig-name descname"><span class="pre">has_no_collisions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ignore_targets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#Prompt.has_no_collisions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.Prompt.has_no_collisions" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ignore_targets</strong> (<em>None</em><em> | </em><em>str</em><em> | </em><em>list</em><em>[</em><em>str</em><em>]</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt.get_target_probs">
<span class="sig-name descname"><span class="pre">get_target_probs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#Prompt.get_target_probs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.Prompt.get_target_probs" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.prompt_utils.Prompt.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_probs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#Prompt.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.Prompt.run" title="Link to this definition">#</a></dt>
<dd><p>Run the prompt through the model and return the probabilities of the next token for both the target tokens.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>get_probs</strong> (<em>Callable</em>)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.prompt_utils.next_token_probs_unsqueeze">
<span class="sig-name descname"><span class="pre">next_token_probs_unsqueeze</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#next_token_probs_unsqueeze"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.next_token_probs_unsqueeze" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>prompt</strong> (<em>str</em><em> | </em><em>list</em><em>[</em><em>str</em><em>]</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Tensor</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.prompt_utils.run_prompts">
<span class="sig-name descname"><span class="pre">run_prompts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size=32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_probs_func=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func_kwargs=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tqdm=&lt;class</span> <span class="pre">'tqdm.asyncio.tqdm_asyncio'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/prompt_utils.html#run_prompts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.prompt_utils.run_prompts" title="Link to this definition">#</a></dt>
<dd><p>Run a list of prompts through the model and return the probabilities of the next token for the target tokens.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>) – The NNSight model</p></li>
<li><p><strong>prompts</strong> (<em>list</em><em>[</em><a class="reference internal" href="#nnterp.prompt_utils.Prompt" title="nnterp.prompt_utils.Prompt"><em>Prompt</em></a><em>]</em>) – A list of prompts. All prompts must have the same target keys</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – The batch size to use</p></li>
<li><p><strong>get_probs</strong> – The function to get the probabilities of the next token, default to next token prediction</p></li>
<li><p><strong>method_kwargs</strong> – The kwargs to pass to the get_probs function</p></li>
<li><p><strong>tqdm</strong> – The tqdm function to use, default to tqdm.auto.tqdm. Use None to disable tqdm</p></li>
<li><p><strong>get_probs_func</strong> (<em>Callable</em><em> | </em><em>None</em>)</p></li>
<li><p><strong>func_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>)</p></li>
<li><p><strong>remote</strong> (<em>bool</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary of target names and the probabilities of the next token for the target tokens.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, <em>Tensor</em>]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-nnterp.display">
<span id="nnterp-display-module"></span><h2>nnterp.display module<a class="headerlink" href="#module-nnterp.display" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="nnterp.display.plot_topk_tokens">
<span class="sig-name descname"><span class="pre">plot_topk_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">next_token_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_token_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_html</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/display.html#plot_topk_tokens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.display.plot_topk_tokens" title="Link to this definition">#</a></dt>
<dd><p>Plot the top k tokens for each layer using Plotly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>next_token_probs</strong> (<em>th.Tensor</em>) – Probability tensor of shape (batch_size, num_layers, vocab_size) or (num_layers, vocab_size) or (vocab_size,)</p></li>
<li><p><strong>tokenizer</strong> – Tokenizer object</p></li>
<li><p><strong>k</strong> (<em>int</em>) – Number of top tokens to plot</p></li>
<li><p><strong>title</strong> (<em>str</em>) – Title of the plot</p></li>
<li><p><strong>use_token_ids</strong> (<em>bool</em>) – If True, use token IDs instead of token strings</p></li>
<li><p><strong>file</strong> (<em>str</em><em>, </em><em>optional</em>) – File path to save the plot</p></li>
<li><p><strong>save_html</strong> (<em>bool</em>) – If True, save an HTML file along with the image</p></li>
<li><p><strong>height</strong> (<em>int</em>)</p></li>
<li><p><strong>width</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Plotly figure object</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>go.Figure</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.display.prompts_to_df">
<span class="sig-name descname"><span class="pre">prompts_to_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/display.html#prompts_to_df"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.display.prompts_to_df" title="Link to this definition">#</a></dt>
<dd><p>Convert a list of prompts to a pandas DataFrame, visualizing the target tokens and strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>prompts</strong> (<em>list</em><em>[</em><a class="reference internal" href="#nnterp.prompt_utils.Prompt" title="nnterp.prompt_utils.Prompt"><em>Prompt</em></a><em>]</em>)</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-nnterp.nnsight_utils">
<span id="nnterp-nnsight-utils-module"></span><h2>nnterp.nnsight_utils module<a class="headerlink" href="#module-nnterp.nnsight_utils" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_embed_tokens">
<span class="sig-name descname"><span class="pre">get_embed_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_embed_tokens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_embed_tokens" title="Link to this definition">#</a></dt>
<dd><p>Get the token embedding layer of the model</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model</strong> (<em>LanguageModel</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Module</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_layers">
<span class="sig-name descname"><span class="pre">get_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_layers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_layers" title="Link to this definition">#</a></dt>
<dd><p>Get the layers of the model</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model</strong> (<em>LanguageModel</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list[<em>Envoy</em>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_num_layers">
<span class="sig-name descname"><span class="pre">get_num_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_num_layers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_num_layers" title="Link to this definition">#</a></dt>
<dd><p>Get the number of layers in the model
:param nn_model: The NNSight model</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The number of layers in the model</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_layer">
<span class="sig-name descname"><span class="pre">get_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_layer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_layer" title="Link to this definition">#</a></dt>
<dd><p>Get the layer of the model
:param nn_model: The NNSight model
:param layer: The layer to get</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Envoy for the layer</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Envoy</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_layer_input">
<span class="sig-name descname"><span class="pre">get_layer_input</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_layer_input"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_layer_input" title="Link to this definition">#</a></dt>
<dd><p>Get the hidden state input of a layer
:param nn_model: The NNSight model
:param layer: The layer to get the input of</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Proxy for the input of the layer</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_layer_output">
<span class="sig-name descname"><span class="pre">get_layer_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_layer_output"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_layer_output" title="Link to this definition">#</a></dt>
<dd><p>Get the residual stream after the layer
:param nn_model: The NNSight model
:param layer: The layer to get the output of</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Proxy for the output of the layer</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_attention">
<span class="sig-name descname"><span class="pre">get_attention</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_attention"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_attention" title="Link to this definition">#</a></dt>
<dd><p>Get the attention module of a layer
:param nn_model: The NNSight model
:param layer: The layer to get the attention module of</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Envoy for the attention module of the layer</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Envoy</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_attention_output">
<span class="sig-name descname"><span class="pre">get_attention_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_attention_output"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_attention_output" title="Link to this definition">#</a></dt>
<dd><p>Get the output of the attention block of a layer
:param nn_model: The NNSight model
:param layer: The layer to get the output of</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Proxy for the output of the attention block of the layer</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_mlp">
<span class="sig-name descname"><span class="pre">get_mlp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_mlp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_mlp" title="Link to this definition">#</a></dt>
<dd><p>Get the MLP module of a layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Envoy</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_mlp_output">
<span class="sig-name descname"><span class="pre">get_mlp_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_mlp_output"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_mlp_output" title="Link to this definition">#</a></dt>
<dd><p>Get the output of the MLP of a layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_logits">
<span class="sig-name descname"><span class="pre">get_logits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_logits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_logits" title="Link to this definition">#</a></dt>
<dd><p>Get the logits of the model
:param nn_model: The NNSight model</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Proxy for the logits of the model</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_unembed_norm">
<span class="sig-name descname"><span class="pre">get_unembed_norm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_unembed_norm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_unembed_norm" title="Link to this definition">#</a></dt>
<dd><p>Get the last layer norm of the model
:param nn_model: The NNSight model</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Envoy for the last layer norm of the model</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Envoy</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_unembed">
<span class="sig-name descname"><span class="pre">get_unembed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_unembed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_unembed" title="Link to this definition">#</a></dt>
<dd><p>Get the unembed module of the model
:param nn_model: The NNSight model</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Envoy for the unembed module of the model</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Envoy</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.project_on_vocab">
<span class="sig-name descname"><span class="pre">project_on_vocab</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#project_on_vocab"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.project_on_vocab" title="Link to this definition">#</a></dt>
<dd><p>Project the hidden states on the vocabulary, after applying the model’s last layer norm
:param nn_model: The NNSight model
:param h: The hidden states to project</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Proxy for the hidden states projected on the vocabulary</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>h</strong> (<em>Tensor</em><em> | </em><em>Object</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_next_token_probs">
<span class="sig-name descname"><span class="pre">get_next_token_probs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_next_token_probs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_next_token_probs" title="Link to this definition">#</a></dt>
<dd><p>Get the probabilities of the model
:param nn_model: The NNSight model</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Proxy for the probabilities of the model</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.set_layer_output">
<span class="sig-name descname"><span class="pre">set_layer_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#set_layer_output"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.set_layer_output" title="Link to this definition">#</a></dt>
<dd><p>Set the output of a layer to a certain tensor.
:param nn_model: The NNSight model
:param layer: The layer to set the output of
:param tensor: The tensor to set the output of the layer to</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
<li><p><strong>tensor</strong> (<em>Tensor</em><em> | </em><em>Object</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.ModuleAccessor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ModuleAccessor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#ModuleAccessor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.ModuleAccessor" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Module that allows to use the NNsight and nnterp renaming utilities on huggingface models, to get the pytorch nn.Module objects with the same standardized names as the StandardizedTransformer class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ModuleAccessor
├── embed_tokens
├── layers
│   ├── self_attn
│   └── mlp
├── ln_final
└── lm_head
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>PreTrainedModel</em>) – The huggingface model to access</p></li>
<li><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em> | </em><em>None</em>) – An optional nnterp RenameConfig if your model has custom module names</p></li>
<li><p><strong>rename</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>] </em><em>| </em><em>None</em>) – An optional dictionary to allow you to have your own custom renaming operations</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.ModuleAccessor.get_embed_tokens">
<span class="sig-name descname"><span class="pre">get_embed_tokens</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#ModuleAccessor.get_embed_tokens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.ModuleAccessor.get_embed_tokens" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Module</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.ModuleAccessor.get_layers">
<span class="sig-name descname"><span class="pre">get_layers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#ModuleAccessor.get_layers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.ModuleAccessor.get_layers" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>ModuleList</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.ModuleAccessor.get_mlp">
<span class="sig-name descname"><span class="pre">get_mlp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#ModuleAccessor.get_mlp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.ModuleAccessor.get_mlp" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>layer</strong> (<em>int</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Module</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.ModuleAccessor.get_attention">
<span class="sig-name descname"><span class="pre">get_attention</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#ModuleAccessor.get_attention"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.ModuleAccessor.get_attention" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>layer</strong> (<em>int</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Module</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.ModuleAccessor.get_unembed_norm">
<span class="sig-name descname"><span class="pre">get_unembed_norm</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#ModuleAccessor.get_unembed_norm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.ModuleAccessor.get_unembed_norm" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Module</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.ModuleAccessor.get_unembed">
<span class="sig-name descname"><span class="pre">get_unembed</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#ModuleAccessor.get_unembed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.ModuleAccessor.get_unembed" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Module</em></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.get_token_activations">
<span class="sig-name descname"><span class="pre">get_token_activations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_activations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tracer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#get_token_activations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.get_token_activations" title="Link to this definition">#</a></dt>
<dd><p>Collect the hidden states of the last token of each prompt at each layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>) – The NNSight model</p></li>
<li><p><strong>prompts</strong> – The prompts to collect activations for. Can be None if you call this from an existing tracer.</p></li>
<li><p><strong>layers</strong> – The layers to collect activations for, default to all layers</p></li>
<li><p><strong>get_activations</strong> (<em>Callable</em><em>[</em><em>[</em><em>LanguageModel</em><em>, </em><em>int</em><em>]</em><em>, </em><em>Tensor</em><em> | </em><em>Object</em><em>] </em><em>| </em><em>None</em>) – The function to get the activations, default to layer output</p></li>
<li><p><strong>remote</strong> – Whether to run the model on the remote device</p></li>
<li><p><strong>idx</strong> (<em>int</em><em> | </em><em>None</em>) – The index of the token to collect activations for</p></li>
<li><p><strong>tracer</strong> – A tracer object to use to collect activations. If None, a new tracer is created.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The hidden states of the last token of each prompt at each layer, moved to cpu. If open_context is False, returns a list of
Proxies. Dimensions are (num_layers, num_prompts, hidden_size)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.collect_last_token_activations_session">
<span class="sig-name descname"><span class="pre">collect_last_token_activations_session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_activations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#collect_last_token_activations_session"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.collect_last_token_activations_session" title="Link to this definition">#</a></dt>
<dd><p>Collect the hidden states of the specified token of each prompt at each layer in batches using a nnsight session.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> – The NNSight model</p></li>
<li><p><strong>prompts</strong> – The prompts to collect activations for</p></li>
<li><p><strong>batch_size</strong> – The batch size to use</p></li>
<li><p><strong>layers</strong> – The layers to collect activations for, default to all layers</p></li>
<li><p><strong>get_activations</strong> – The function to get the activations, default to layer output</p></li>
<li><p><strong>remote</strong> – Whether to run the model on the remote device</p></li>
<li><p><strong>idx</strong> – The index of the token to collect activations for. Default is -1 (last token).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The hidden states of the specified token of each prompt at each layer, moved to cpu.
Dimensions are (num_layers, num_prompts, hidden_size)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.collect_token_activations_batched">
<span class="sig-name descname"><span class="pre">collect_token_activations_batched</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_activations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tqdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_session</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#collect_token_activations_batched"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.collect_token_activations_batched" title="Link to this definition">#</a></dt>
<dd><p>Collect the hidden states of the last token of each prompt at each layer in batches</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>) – The NNSight model</p></li>
<li><p><strong>prompts</strong> – The prompts to collect activations for</p></li>
<li><p><strong>batch_size</strong> – The batch size to use</p></li>
<li><p><strong>layers</strong> – The layers to collect activations for, default to all layers</p></li>
<li><p><strong>get_activations</strong> (<em>Callable</em><em>[</em><em>[</em><em>LanguageModel</em><em>, </em><em>int</em><em>]</em><em>, </em><em>Tensor</em><em> | </em><em>Object</em><em>] </em><em>| </em><em>None</em>) – The function to get the activations, default to layer output</p></li>
<li><p><strong>remote</strong> – Whether to run the model on the remote device</p></li>
<li><p><strong>idx</strong> – The index of the token to collect activations for. Default is -1 (last token).</p></li>
<li><p><strong>tqdm</strong> – Whether to use tqdm to show progress, default to None (no progress bar)</p></li>
<li><p><strong>use_session</strong> – Whether to use a nnsight session to collect activations. Not sure why you’d want turn that off but who knows</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The hidden states of the specified token of each prompt at each layer, moved to cpu.
Dimensions are (num_layers, num_prompts, hidden_size)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.nnsight_utils.compute_next_token_probs">
<span class="sig-name descname"><span class="pre">compute_next_token_probs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/nnsight_utils.html#compute_next_token_probs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.nnsight_utils.compute_next_token_probs" title="Link to this definition">#</a></dt>
<dd><p>Get the probabilities of the next token for the prompt
:param nn_model: The NNSight model
:param prompt: The prompt to get the probabilities for
:param remote: Whether to run the model on the remote device</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The probabilities of the next token for the prompt</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nn_model</strong> (<em>LanguageModel</em>)</p></li>
<li><p><strong>prompt</strong> (<em>str</em><em> | </em><em>list</em><em>[</em><em>str</em><em>]</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tensor</em></p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="internal-modules">
<h1>Internal Modules<a class="headerlink" href="#internal-modules" title="Link to this heading">#</a></h1>
<section id="module-nnterp.utils">
<span id="nnterp-utils-module"></span><h2>nnterp.utils module<a class="headerlink" href="#module-nnterp.utils" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="nnterp.utils.ArchitectureNotFound">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ArchitectureNotFound</span></span><a class="reference internal" href="_modules/nnterp/utils.html#ArchitectureNotFound"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.ArchitectureNotFound" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.utils.is_notebook">
<span class="sig-name descname"><span class="pre">is_notebook</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/utils.html#is_notebook"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.is_notebook" title="Link to this definition">#</a></dt>
<dd><p>Detect the current Python environment</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.utils.display_markdown">
<span class="sig-name descname"><span class="pre">display_markdown</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/utils.html#display_markdown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.display_markdown" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>text</strong> (<em>str</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.utils.display_source">
<span class="sig-name descname"><span class="pre">display_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/utils.html#display_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.display_source" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>source</strong> (<em>str</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.utils.DummyCache">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DummyCache</span></span><a class="reference internal" href="_modules/nnterp/utils.html#DummyCache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.DummyCache" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="nnterp.utils.DummyCache.to_legacy_cache">
<span class="sig-name descname"><span class="pre">to_legacy_cache</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/utils.html#DummyCache.to_legacy_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.DummyCache.to_legacy_cache" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.utils.dummy_inputs">
<span class="sig-name descname"><span class="pre">dummy_inputs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/utils.html#dummy_inputs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.dummy_inputs" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.utils.try_with_scan">
<span class="sig-name descname"><span class="pre">try_with_scan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_to_throw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_dispatch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warn_if_scan_fails</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors_to_raise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/utils.html#try_with_scan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.try_with_scan" title="Link to this definition">#</a></dt>
<dd><p>Attempt to execute a function using model.scan(), falling back to model.trace() if needed.</p>
<p>This function tries to execute the given function within a model.scan() context first,
which avoids dispatching the model. If that fails and fallback is allowed, it will
try using model.trace() instead, which does dispatch the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – The model object that supports .scan() and .trace() methods</p></li>
<li><p><strong>function</strong> – A callable to execute within the model context (takes no arguments)</p></li>
<li><p><strong>error_to_throw</strong> (<em>Exception</em>) – Exception to raise if both scan and trace fail</p></li>
<li><p><strong>allow_dispatch</strong> (<em>bool</em>) – Whether to allow fallback to .trace() if .scan() fails</p></li>
<li><p><strong>warn_if_scan_fails</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to log warnings when scan fails.
Defaults to True.</p></li>
<li><p><strong>errors_to_raise</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Tuple of exception types that should be raised
immediately if encountered during scan, without fallback to trace.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if scan succeeded, False if trace was used instead</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.utils.unpack_tuple">
<span class="sig-name descname"><span class="pre">unpack_tuple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor_or_tuple</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/utils.html#unpack_tuple"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.utils.unpack_tuple" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tensor_or_tuple</strong> (<em>Tensor</em><em> | </em><em>Object</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Tensor</em> | <em>Object</em></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-nnterp.rename_utils">
<span id="nnterp-rename-utils-module"></span><h2>nnterp.rename_utils module<a class="headerlink" href="#module-nnterp.rename_utils" title="Link to this heading">#</a></h2>
<dl class="py exception">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenamingError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">RenamingError</span></span><a class="reference internal" href="_modules/nnterp/rename_utils.html#RenamingError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.RenamingError" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Exception raised when the renaming of modules is not properly done.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.rename_utils.AttnProbFunction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">AttnProbFunction</span></span><a class="reference internal" href="_modules/nnterp/rename_utils.html#AttnProbFunction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.AttnProbFunction" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="nnterp.rename_utils.AttnProbFunction.get_attention_prob_source">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_attention_prob_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attention_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_module_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#AttnProbFunction.get_attention_prob_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.AttnProbFunction.get_attention_prob_source" title="Link to this definition">#</a></dt>
<dd><p>Get the attention probabilities source for a given attention module. If return_module_source is True,
return the full module source from where the attention probabilities are computed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>return_module_source</strong> (<em>bool</em>)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">RenameConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attn_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mlp_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ln_final_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lm_head_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layers_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attn_prob_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_mlp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_attn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attn_head_config_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size_config_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vocab_size_config_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#RenameConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.RenameConfig" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Configuration for renaming transformer model modules to standardized names.</p>
<p>This dataclass specifies how to map model-specific module names to standardized names
used by nnterp. It allows customization for different transformer architectures.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>attn_name</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Name(s) of the attention module to rename to ‘self_attn’.</p></li>
<li><p><strong>mlp_name</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Name(s) of the MLP/feed-forward module to rename to ‘mlp’.</p></li>
<li><p><strong>ln_final_name</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Name(s) of the final layer normalization to rename to ‘ln_final’.</p></li>
<li><p><strong>lm_head_name</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Name(s) of the language model head to rename to ‘lm_head’.</p></li>
<li><p><strong>model_name</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Name(s) of the main model container to rename to ‘model’.</p></li>
<li><p><strong>layers_name</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Name(s) of the transformer layers container to rename to ‘layers’.</p></li>
<li><p><strong>attn_prob_source</strong> (<a class="reference internal" href="#nnterp.rename_utils.AttnProbFunction" title="nnterp.rename_utils.AttnProbFunction"><em>AttnProbFunction</em></a><em>, </em><em>optional</em>) – Custom function for accessing attention probabilities.
Should be an instance of AttnProbFunction that defines how to extract
attention weights from the attention module.</p></li>
<li><p><strong>ignore_mlp</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to skip MLP module processing for this architecture.
Some models (e.g., OPT) don’t have a unified MLP module.</p></li>
<li><p><strong>ignore_attn</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to skip attention module processing for this architecture.
Rarely used, for architectures without standard attention.</p></li>
<li><p><strong>attn_head_config_key</strong> (<em>str</em><em>, </em><em>list</em><em> of </em><em>str</em><em>, or </em><em>int</em><em>, </em><em>optional</em>) – Custom key name for the number of attention heads in model config,
or the number of heads directly. Defaults to standard keys:
[‘n_heads’, ‘num_attention_heads’, ‘n_head’].</p></li>
<li><p><strong>hidden_size_config_key</strong> (<em>str</em><em>, </em><em>list</em><em> of </em><em>str</em><em>, or </em><em>int</em><em>, </em><em>optional</em>) – Custom key name for hidden size in model config,
or the hidden size directly. Defaults to standard keys:
[‘hidden_size’, ‘d_model’, ‘n_embd’].</p></li>
<li><p><strong>vocab_size_config_key</strong> (<em>str</em><em>, </em><em>list</em><em> of </em><em>str</em><em>, or </em><em>int</em><em>, </em><em>optional</em>) – Custom key name for vocab size in model config,
or the vocab size directly. Defaults to standard keys:
[‘vocab_size’, ‘n_vocab’, ‘text_config.vocab_size’].</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p>Custom configuration for a non-standard architecture:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">RenameConfig</span><span class="p">(</span>
    <span class="n">attn_name</span><span class="o">=</span><span class="s2">&quot;custom_attention&quot;</span><span class="p">,</span>
    <span class="n">mlp_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feed_forward&quot;</span><span class="p">,</span> <span class="s2">&quot;ffn&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.attn_name">
<span class="sig-name descname"><span class="pre">attn_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.attn_name" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.mlp_name">
<span class="sig-name descname"><span class="pre">mlp_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.mlp_name" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.ln_final_name">
<span class="sig-name descname"><span class="pre">ln_final_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.ln_final_name" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.lm_head_name">
<span class="sig-name descname"><span class="pre">lm_head_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.lm_head_name" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.model_name">
<span class="sig-name descname"><span class="pre">model_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.model_name" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.layers_name">
<span class="sig-name descname"><span class="pre">layers_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.layers_name" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.attn_prob_source">
<span class="sig-name descname"><span class="pre">attn_prob_source</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#nnterp.rename_utils.AttnProbFunction" title="nnterp.rename_utils.AttnProbFunction"><span class="pre">AttnProbFunction</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.attn_prob_source" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.ignore_mlp">
<span class="sig-name descname"><span class="pre">ignore_mlp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.ignore_mlp" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.ignore_attn">
<span class="sig-name descname"><span class="pre">ignore_attn</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.ignore_attn" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.attn_head_config_key">
<span class="sig-name descname"><span class="pre">attn_head_config_key</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.attn_head_config_key" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.hidden_size_config_key">
<span class="sig-name descname"><span class="pre">hidden_size_config_key</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.hidden_size_config_key" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.RenameConfig.vocab_size_config_key">
<span class="sig-name descname"><span class="pre">vocab_size_config_key</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.RenameConfig.vocab_size_config_key" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.expand_path_with_model">
<span class="sig-name descname"><span class="pre">expand_path_with_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">paths</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#expand_path_with_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.expand_path_with_model" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>paths</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.default_attn_head_config_keys">
<span class="sig-name descname"><span class="pre">default_attn_head_config_keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#default_attn_head_config_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.default_attn_head_config_keys" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.default_hidden_size_config_keys">
<span class="sig-name descname"><span class="pre">default_hidden_size_config_keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#default_hidden_size_config_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.default_hidden_size_config_keys" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.default_vocab_size_config_keys">
<span class="sig-name descname"><span class="pre">default_vocab_size_config_keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#default_vocab_size_config_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.default_vocab_size_config_keys" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.get_rename_dict">
<span class="sig-name descname"><span class="pre">get_rename_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#get_rename_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.get_rename_dict" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em> | </em><em>None</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict[str, str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.text_config">
<span class="sig-name descname"><span class="pre">text_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#text_config"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.text_config" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.get_num_attention_heads">
<span class="sig-name descname"><span class="pre">get_num_attention_heads</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#get_num_attention_heads"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.get_num_attention_heads" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raise_error</strong> (<em>bool</em>)</p></li>
<li><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em> | </em><em>None</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.get_hidden_size">
<span class="sig-name descname"><span class="pre">get_hidden_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#get_hidden_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.get_hidden_size" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raise_error</strong> (<em>bool</em>)</p></li>
<li><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em> | </em><em>None</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.get_vocab_size">
<span class="sig-name descname"><span class="pre">get_vocab_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#get_vocab_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.get_vocab_size" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raise_error</strong> (<em>bool</em>)</p></li>
<li><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em> | </em><em>None</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.rename_utils.IOType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">IOType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#IOType"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.IOType" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Enum to specify input or output access</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.IOType.INPUT">
<span class="sig-name descname"><span class="pre">INPUT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'input'</span></em><a class="headerlink" href="#nnterp.rename_utils.IOType.INPUT" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnterp.rename_utils.IOType.OUTPUT">
<span class="sig-name descname"><span class="pre">OUTPUT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'output'</span></em><a class="headerlink" href="#nnterp.rename_utils.IOType.OUTPUT" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.rename_utils.LayerAccessor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">LayerAccessor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attr_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">io_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#LayerAccessor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.LayerAccessor" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>I/O accessor that provides input/output access with setter</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>attr_name</strong> (<em>str</em><em> | </em><em>None</em>)</p></li>
<li><p><strong>io_type</strong> (<a class="reference internal" href="#nnterp.rename_utils.IOType" title="nnterp.rename_utils.IOType"><em>IOType</em></a><em> | </em><em>None</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="nnterp.rename_utils.LayerAccessor.get_module">
<span class="sig-name descname"><span class="pre">get_module</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#LayerAccessor.get_module"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.LayerAccessor.get_module" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>layer</strong> (<em>int</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Envoy</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnterp.rename_utils.LayerAccessor.returns_tuple">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">returns_tuple</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#nnterp.rename_utils.LayerAccessor.returns_tuple" title="Link to this definition">#</a></dt>
<dd><p>Returns whether the layer output is a tuple.
Returns None if the tuple status has not been detected yet.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.bloom_attention_prob_source">
<span class="sig-name descname"><span class="pre">bloom_attention_prob_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attention_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_module_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#bloom_attention_prob_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.bloom_attention_prob_source" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>return_module_source</strong> (<em>bool</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.default_attention_prob_source">
<span class="sig-name descname"><span class="pre">default_attention_prob_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attention_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_module_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#default_attention_prob_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.default_attention_prob_source" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>return_module_source</strong> (<em>bool</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.gpt2_attention_prob_source">
<span class="sig-name descname"><span class="pre">gpt2_attention_prob_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attention_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_module_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#gpt2_attention_prob_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.gpt2_attention_prob_source" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>return_module_source</strong> (<em>bool</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.gptj_attention_prob_source">
<span class="sig-name descname"><span class="pre">gptj_attention_prob_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attention_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_module_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#gptj_attention_prob_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.gptj_attention_prob_source" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>return_module_source</strong> (<em>bool</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnterp.rename_utils.AttentionProbabilitiesAccessor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">AttentionProbabilitiesAccessor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialized_with_enable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#AttentionProbabilitiesAccessor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em> | </em><em>None</em>)</p></li>
<li><p><strong>initialized_with_enable</strong> (<em>bool</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="nnterp.rename_utils.AttentionProbabilitiesAccessor.disable">
<span class="sig-name descname"><span class="pre">disable</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#AttentionProbabilitiesAccessor.disable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor.disable" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.rename_utils.AttentionProbabilitiesAccessor.check_source">
<span class="sig-name descname"><span class="pre">check_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_dispatch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_trace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#AttentionProbabilitiesAccessor.check_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor.check_source" title="Link to this definition">#</a></dt>
<dd><p>Check that the attention probabilities source is correctly configured.</p>
<p>This method validates that:
1. The attention probabilities have the expected shape (batch_size, num_heads, seq_len, seq_len)
2. The probabilities sum to 1 along the last dimension
3. Modifying the probabilities affects the model’s output logits</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>int</em><em>, </em><em>optional</em>) – The layer index to check. Defaults to 0.</p></li>
<li><p><strong>allow_dispatch</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, allows dispatching the model when scan fails.</p></li>
<li><p><strong>use_trace</strong> (<em>bool</em><em>, </em><em>optional</em>) – If False, uses scan() to validate the attention probabilities, which means attention probabilities summing to 1 and causal effect of modifying them won’t be tested. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#nnterp.rename_utils.RenamingError" title="nnterp.rename_utils.RenamingError"><strong>RenamingError</strong></a> – If the attention probabilities are not properly configured or if the number of attention heads is not available.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnterp.rename_utils.AttentionProbabilitiesAccessor.print_source">
<span class="sig-name descname"><span class="pre">print_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_dispatch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#AttentionProbabilitiesAccessor.print_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor.print_source" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>int</em>)</p></li>
<li><p><strong>allow_dispatch</strong> (<em>bool</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.get_ignores">
<span class="sig-name descname"><span class="pre">get_ignores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#get_ignores"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.get_ignores" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rename_config</strong> (<a class="reference internal" href="#nnterp.rename_utils.RenameConfig" title="nnterp.rename_utils.RenameConfig"><em>RenameConfig</em></a><em> | </em><em>None</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.check_io">
<span class="sig-name descname"><span class="pre">check_io</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">std_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignores</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#check_io"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.check_io" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_name</strong> (<em>str</em>)</p></li>
<li><p><strong>ignores</strong> (<em>list</em><em>[</em><em>Literal</em><em>[</em><em>'mlp'</em><em>, </em><em>'attention'</em><em>]</em><em>]</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nnterp.rename_utils.check_model_renaming">
<span class="sig-name descname"><span class="pre">check_model_renaming</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">std_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignores</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_dispatch</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nnterp/rename_utils.html#check_model_renaming"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nnterp.rename_utils.check_model_renaming" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_name</strong> (<em>str</em>)</p></li>
<li><p><strong>ignores</strong> (<em>list</em><em>[</em><em>Literal</em><em>[</em><em>'mlp'</em><em>, </em><em>'attention'</em><em>]</em><em>]</em>)</p></li>
<li><p><strong>allow_dispatch</strong> (<em>bool</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Documentation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-nnterp.standardized_transformer">nnterp.standardized_transformer module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.num_layers"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.num_layers</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.num_heads"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.num_heads</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.hidden_size"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.hidden_size</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.vocab_size"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.vocab_size</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.detect_layer_output_type"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.detect_layer_output_type()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.add_prefix_false_tokenizer"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.add_prefix_false_tokenizer</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.attn_probs_available"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.attn_probs_available</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.input_ids"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.input_ids</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.input_size"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.input_size</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.attention_mask"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.attention_mask</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.token_embeddings"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.token_embeddings</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.logits"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.logits</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.next_token_probs"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.next_token_probs</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.skip_layer"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.skip_layer()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.skip_layers"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.skip_layers()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.steer"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.steer()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.project_on_vocab"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.project_on_vocab()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.probs_to_dict"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.probs_to_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.standardized_transformer.StandardizedTransformer.get_topk_closest_tokens"><code class="docutils literal notranslate"><span class="pre">StandardizedTransformer.get_topk_closest_tokens()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-nnterp.interventions">nnterp.interventions module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.logit_lens"><code class="docutils literal notranslate"><span class="pre">logit_lens()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPrompt"><code class="docutils literal notranslate"><span class="pre">TargetPrompt</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPrompt.prompt"><code class="docutils literal notranslate"><span class="pre">TargetPrompt.prompt</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPrompt.index_to_patch"><code class="docutils literal notranslate"><span class="pre">TargetPrompt.index_to_patch</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.repeat_prompt"><code class="docutils literal notranslate"><span class="pre">repeat_prompt()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPromptBatch"><code class="docutils literal notranslate"><span class="pre">TargetPromptBatch</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPromptBatch.prompts"><code class="docutils literal notranslate"><span class="pre">TargetPromptBatch.prompts</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPromptBatch.index_to_patch"><code class="docutils literal notranslate"><span class="pre">TargetPromptBatch.index_to_patch</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPromptBatch.from_target_prompts"><code class="docutils literal notranslate"><span class="pre">TargetPromptBatch.from_target_prompts()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPromptBatch.from_target_prompt"><code class="docutils literal notranslate"><span class="pre">TargetPromptBatch.from_target_prompt()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPromptBatch.from_prompts"><code class="docutils literal notranslate"><span class="pre">TargetPromptBatch.from_prompts()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.TargetPromptBatch.auto"><code class="docutils literal notranslate"><span class="pre">TargetPromptBatch.auto()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.patchscope_lens"><code class="docutils literal notranslate"><span class="pre">patchscope_lens()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.patchscope_generate"><code class="docutils literal notranslate"><span class="pre">patchscope_generate()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.steer"><code class="docutils literal notranslate"><span class="pre">steer()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.interventions.patch_object_attn_lens"><code class="docutils literal notranslate"><span class="pre">patch_object_attn_lens()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-nnterp.prompt_utils">nnterp.prompt_utils module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.TokenizationError"><code class="docutils literal notranslate"><span class="pre">TokenizationError</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.get_first_tokens"><code class="docutils literal notranslate"><span class="pre">get_first_tokens()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt"><code class="docutils literal notranslate"><span class="pre">Prompt</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt.prompt"><code class="docutils literal notranslate"><span class="pre">Prompt.prompt</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt.target_tokens"><code class="docutils literal notranslate"><span class="pre">Prompt.target_tokens</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt.target_strings"><code class="docutils literal notranslate"><span class="pre">Prompt.target_strings</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt.from_strings"><code class="docutils literal notranslate"><span class="pre">Prompt.from_strings()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt.has_no_collisions"><code class="docutils literal notranslate"><span class="pre">Prompt.has_no_collisions()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt.get_target_probs"><code class="docutils literal notranslate"><span class="pre">Prompt.get_target_probs()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.Prompt.run"><code class="docutils literal notranslate"><span class="pre">Prompt.run()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.next_token_probs_unsqueeze"><code class="docutils literal notranslate"><span class="pre">next_token_probs_unsqueeze()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.prompt_utils.run_prompts"><code class="docutils literal notranslate"><span class="pre">run_prompts()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-nnterp.display">nnterp.display module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.display.plot_topk_tokens"><code class="docutils literal notranslate"><span class="pre">plot_topk_tokens()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.display.prompts_to_df"><code class="docutils literal notranslate"><span class="pre">prompts_to_df()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-nnterp.nnsight_utils">nnterp.nnsight_utils module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_embed_tokens"><code class="docutils literal notranslate"><span class="pre">get_embed_tokens()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_layers"><code class="docutils literal notranslate"><span class="pre">get_layers()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_num_layers"><code class="docutils literal notranslate"><span class="pre">get_num_layers()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_layer"><code class="docutils literal notranslate"><span class="pre">get_layer()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_layer_input"><code class="docutils literal notranslate"><span class="pre">get_layer_input()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_layer_output"><code class="docutils literal notranslate"><span class="pre">get_layer_output()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_attention"><code class="docutils literal notranslate"><span class="pre">get_attention()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_attention_output"><code class="docutils literal notranslate"><span class="pre">get_attention_output()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_mlp"><code class="docutils literal notranslate"><span class="pre">get_mlp()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_mlp_output"><code class="docutils literal notranslate"><span class="pre">get_mlp_output()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_logits"><code class="docutils literal notranslate"><span class="pre">get_logits()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_unembed_norm"><code class="docutils literal notranslate"><span class="pre">get_unembed_norm()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_unembed"><code class="docutils literal notranslate"><span class="pre">get_unembed()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.project_on_vocab"><code class="docutils literal notranslate"><span class="pre">project_on_vocab()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_next_token_probs"><code class="docutils literal notranslate"><span class="pre">get_next_token_probs()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.set_layer_output"><code class="docutils literal notranslate"><span class="pre">set_layer_output()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.ModuleAccessor"><code class="docutils literal notranslate"><span class="pre">ModuleAccessor</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.ModuleAccessor.get_embed_tokens"><code class="docutils literal notranslate"><span class="pre">ModuleAccessor.get_embed_tokens()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.ModuleAccessor.get_layers"><code class="docutils literal notranslate"><span class="pre">ModuleAccessor.get_layers()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.ModuleAccessor.get_mlp"><code class="docutils literal notranslate"><span class="pre">ModuleAccessor.get_mlp()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.ModuleAccessor.get_attention"><code class="docutils literal notranslate"><span class="pre">ModuleAccessor.get_attention()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.ModuleAccessor.get_unembed_norm"><code class="docutils literal notranslate"><span class="pre">ModuleAccessor.get_unembed_norm()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.ModuleAccessor.get_unembed"><code class="docutils literal notranslate"><span class="pre">ModuleAccessor.get_unembed()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.get_token_activations"><code class="docutils literal notranslate"><span class="pre">get_token_activations()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.collect_last_token_activations_session"><code class="docutils literal notranslate"><span class="pre">collect_last_token_activations_session()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.collect_token_activations_batched"><code class="docutils literal notranslate"><span class="pre">collect_token_activations_batched()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.nnsight_utils.compute_next_token_probs"><code class="docutils literal notranslate"><span class="pre">compute_next_token_probs()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#internal-modules">Internal Modules</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-nnterp.utils">nnterp.utils module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.ArchitectureNotFound"><code class="docutils literal notranslate"><span class="pre">ArchitectureNotFound</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.is_notebook"><code class="docutils literal notranslate"><span class="pre">is_notebook()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.display_markdown"><code class="docutils literal notranslate"><span class="pre">display_markdown()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.display_source"><code class="docutils literal notranslate"><span class="pre">display_source()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.DummyCache"><code class="docutils literal notranslate"><span class="pre">DummyCache</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.DummyCache.to_legacy_cache"><code class="docutils literal notranslate"><span class="pre">DummyCache.to_legacy_cache()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.dummy_inputs"><code class="docutils literal notranslate"><span class="pre">dummy_inputs()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.try_with_scan"><code class="docutils literal notranslate"><span class="pre">try_with_scan()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.utils.unpack_tuple"><code class="docutils literal notranslate"><span class="pre">unpack_tuple()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-nnterp.rename_utils">nnterp.rename_utils module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenamingError"><code class="docutils literal notranslate"><span class="pre">RenamingError</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.AttnProbFunction"><code class="docutils literal notranslate"><span class="pre">AttnProbFunction</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.AttnProbFunction.get_attention_prob_source"><code class="docutils literal notranslate"><span class="pre">AttnProbFunction.get_attention_prob_source()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig"><code class="docutils literal notranslate"><span class="pre">RenameConfig</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.attn_name"><code class="docutils literal notranslate"><span class="pre">RenameConfig.attn_name</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.mlp_name"><code class="docutils literal notranslate"><span class="pre">RenameConfig.mlp_name</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.ln_final_name"><code class="docutils literal notranslate"><span class="pre">RenameConfig.ln_final_name</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.lm_head_name"><code class="docutils literal notranslate"><span class="pre">RenameConfig.lm_head_name</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.model_name"><code class="docutils literal notranslate"><span class="pre">RenameConfig.model_name</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.layers_name"><code class="docutils literal notranslate"><span class="pre">RenameConfig.layers_name</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.attn_prob_source"><code class="docutils literal notranslate"><span class="pre">RenameConfig.attn_prob_source</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.ignore_mlp"><code class="docutils literal notranslate"><span class="pre">RenameConfig.ignore_mlp</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.ignore_attn"><code class="docutils literal notranslate"><span class="pre">RenameConfig.ignore_attn</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.attn_head_config_key"><code class="docutils literal notranslate"><span class="pre">RenameConfig.attn_head_config_key</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.hidden_size_config_key"><code class="docutils literal notranslate"><span class="pre">RenameConfig.hidden_size_config_key</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.RenameConfig.vocab_size_config_key"><code class="docutils literal notranslate"><span class="pre">RenameConfig.vocab_size_config_key</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.expand_path_with_model"><code class="docutils literal notranslate"><span class="pre">expand_path_with_model()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.default_attn_head_config_keys"><code class="docutils literal notranslate"><span class="pre">default_attn_head_config_keys()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.default_hidden_size_config_keys"><code class="docutils literal notranslate"><span class="pre">default_hidden_size_config_keys()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.default_vocab_size_config_keys"><code class="docutils literal notranslate"><span class="pre">default_vocab_size_config_keys()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.get_rename_dict"><code class="docutils literal notranslate"><span class="pre">get_rename_dict()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.text_config"><code class="docutils literal notranslate"><span class="pre">text_config()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.get_num_attention_heads"><code class="docutils literal notranslate"><span class="pre">get_num_attention_heads()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.get_hidden_size"><code class="docutils literal notranslate"><span class="pre">get_hidden_size()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.get_vocab_size"><code class="docutils literal notranslate"><span class="pre">get_vocab_size()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.IOType"><code class="docutils literal notranslate"><span class="pre">IOType</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.IOType.INPUT"><code class="docutils literal notranslate"><span class="pre">IOType.INPUT</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.IOType.OUTPUT"><code class="docutils literal notranslate"><span class="pre">IOType.OUTPUT</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.LayerAccessor"><code class="docutils literal notranslate"><span class="pre">LayerAccessor</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.LayerAccessor.get_module"><code class="docutils literal notranslate"><span class="pre">LayerAccessor.get_module()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.LayerAccessor.returns_tuple"><code class="docutils literal notranslate"><span class="pre">LayerAccessor.returns_tuple</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.bloom_attention_prob_source"><code class="docutils literal notranslate"><span class="pre">bloom_attention_prob_source()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.default_attention_prob_source"><code class="docutils literal notranslate"><span class="pre">default_attention_prob_source()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.gpt2_attention_prob_source"><code class="docutils literal notranslate"><span class="pre">gpt2_attention_prob_source()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.gptj_attention_prob_source"><code class="docutils literal notranslate"><span class="pre">gptj_attention_prob_source()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor"><code class="docutils literal notranslate"><span class="pre">AttentionProbabilitiesAccessor</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor.disable"><code class="docutils literal notranslate"><span class="pre">AttentionProbabilitiesAccessor.disable()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor.check_source"><code class="docutils literal notranslate"><span class="pre">AttentionProbabilitiesAccessor.check_source()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.AttentionProbabilitiesAccessor.print_source"><code class="docutils literal notranslate"><span class="pre">AttentionProbabilitiesAccessor.print_source()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.get_ignores"><code class="docutils literal notranslate"><span class="pre">get_ignores()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.check_io"><code class="docutils literal notranslate"><span class="pre">check_io()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nnterp.rename_utils.check_model_renaming"><code class="docutils literal notranslate"><span class="pre">check_model_renaming()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/api.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Clément Dumas.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>